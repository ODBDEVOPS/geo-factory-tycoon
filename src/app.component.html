
<div class="relative w-screen h-screen overflow-hidden bg-cover bg-center" style="background-image: url('https://picsum.photos/seed/space/1920/1080');">
  <div class="absolute inset-0 bg-blue-900/40 backdrop-brightness-50"></div>
  
  <div class="relative flex w-full h-full">
    <!-- MOBILE MENU BUTTON -->
    <button (click)="toggleSidebar()" class="lg:hidden quantum-btn fixed top-4 left-4 z-40 p-2 rounded-md h-12 w-12 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
      </svg>
    </button>

    <!-- SIDEBAR -->
    <aside 
      [class]="'fixed lg:relative z-30 w-80 lg:w-96 h-full flex flex-col p-4 space-y-4 transform transition-transform duration-300 ease-in-out ' + (isSidebarVisible() ? 'translate-x-0' : '-translate-x-full lg:translate-x-0')">
      
      <!-- HEADER -->
      <div class="holo-panel p-4 rounded-lg flex-shrink-0">
        <h1 class="text-2xl font-bold text-cyan-300 text-center tracking-widest">GEO-FACTORY 7.0</h1>
        <div class="grid grid-cols-2 gap-2 mt-4 text-center">
          <div class="p-2 rounded bg-black/20">
            <span class="text-xs text-cyan-400">Quantum Data</span>
            <span class="block text-lg font-bold">{{ formatNumber(gameState.resources()['quantum_data']) }}</span>
          </div>
          <div class="p-2 rounded bg-black/20">
            <span class="text-xs text-red-400">Antimatter</span>
            <span class="block text-lg font-bold">{{ formatNumber(gameState.resources()['antimatter']) }}</span>
          </div>
          <div class="p-2 rounded bg-black/20">
            <span class="text-xs text-green-400">Drones</span>
            <span class="block text-lg font-bold">{{ gameState.resources()['drones'] }}</span>
          </div>
           <div class="p-2 rounded bg-black/20">
            <span class="text-xs text-yellow-400">Credits</span>
            <span class="block text-lg font-bold">{{ formatNumber(gameState.resources()['credits']) }}</span>
          </div>
        </div>
      </div>

      <!-- MACHINE LISTS -->
      <div class="holo-panel p-4 rounded-lg flex-grow overflow-y-auto">
        <div class="mb-4">
          <h4 class="category-title text-cyan-400 border-b border-cyan-400/30 pb-1 mb-2">Machines Quantiques</h4>
          <div class="space-y-2">
            @for (machine of gameState.quantumMachines(); track machine.id) {
              <button [class]="'machine-btn w-full text-left p-2 rounded-md flex items-center space-x-3 transition-colors hover:bg-cyan-400/20 ' + (machine.unlocked ? '' : 'locked')">
                <span class="text-2xl">{{ getMachineIcon(machine.id) }}</span>
                <div>
                  <span class="font-semibold">{{ machine.name }}</span>
                  <span class="block text-xs text-yellow-400">{{ formatNumber(machine.cost) }} cr√©dits</span>
                </div>
                @if (!machine.unlocked) {
                  <span class="ml-auto text-lg">üîí</span>
                }
              </button>
            }
          </div>
        </div>
        <div>
          <h4 class="category-title text-green-400 border-b border-green-400/30 pb-1 mb-2">Syst√®mes Avanc√©s</h4>
           <div class="space-y-2">
            @for (machine of gameState.advancedMachines(); track machine.id) {
              <button [class]="'machine-btn w-full text-left p-2 rounded-md flex items-center space-x-3 transition-colors hover:bg-green-400/20 ' + (machine.unlocked ? '' : 'locked')">
                <span class="text-2xl">{{ getMachineIcon(machine.id) }}</span>
                <div>
                  <span class="font-semibold">{{ machine.name }}</span>
                  <span class="block text-xs text-yellow-400">{{ formatNumber(machine.cost) }} cr√©dits</span>
                </div>
                 @if (!machine.unlocked) {
                  <span class="ml-auto text-lg">üîí</span>
                }
              </button>
            }
          </div>
        </div>
      </div>

      <!-- ACTION BUTTONS -->
      <div class="holo-panel p-4 rounded-lg flex-shrink-0 grid grid-cols-2 gap-2">
        <button (click)="openModal('research')" class="quantum-btn col-span-2 text-sm py-3 px-4 rounded-full font-bold uppercase tracking-wider">Recherche Quantum</button>
        <button (click)="openModal('drones')" class="quantum-btn text-sm py-3 px-4 rounded-full font-bold uppercase tracking-wider">Contr√¥le Drones</button>
        <button (click)="openModal('time')" class="quantum-btn text-sm py-3 px-4 rounded-full font-bold uppercase tracking-wider">D√©formation Temporelle</button>
      </div>
    </aside>

    <!-- GAME AREA -->
    <main class="flex-grow h-full p-4 lg:p-8">
      <div id="gameGrid" class="w-full h-full grid grid-cols-8 md:grid-cols-12 lg:grid-cols-16 gap-2 holo-panel rounded-lg p-4">
        <!-- Example machines with animations -->
        <div class="w-full h-full rounded bg-cyan-900/50 border-2 border-cyan-400 shadow-lg shadow-cyan-400/50 animate-pulse flex items-center justify-center text-4xl" title="Quantum Processor">üß†</div>
        <div class="w-full h-full rounded bg-red-900/50 border-2 border-red-500 shadow-lg shadow-red-500/50 animate-pulse flex items-center justify-center text-4xl" title="Antimatter Reactor">üí•</div>
        <div class="w-full h-full rounded bg-purple-900/50 border-2 border-purple-500 animate-[spin_4s_linear_infinite] flex items-center justify-center text-4xl" title="Teleporter Pad">üåÄ</div>
        <div class="w-full h-full rounded bg-indigo-900/50 border-2 border-indigo-400 animate-pulse flex items-center justify-center text-4xl col-start-4" title="Gravity Well">üï≥Ô∏è</div>
        <div class="w-full h-full rounded bg-teal-900/50 border-2 border-teal-400 animate-pulse flex items-center justify-center text-4xl row-start-3" title="Bio-Fabricator">üåø</div>
         <div class="w-full h-full rounded bg-green-900/50 border-2 border-green-500 animate-[bounce_2s_ease-in-out_infinite] flex items-center justify-center text-4xl row-start-4 col-start-6" title="Drone Hub">üõ∞Ô∏è</div>
      </div>
    </main>
  </div>

  <!-- MODALS -->
  @if (activeModal() !== 'none') {
    <div class="fixed inset-0 z-40 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4" (click)="closeModal()">
      <!-- QUANTUM RESEARCH MODAL -->
      @if (activeModal() === 'research') {
        <div class="holo-panel rounded-lg w-full max-w-4xl max-h-[90vh] flex flex-col" (click)="$event.stopPropagation()">
          <div class="p-4 border-b border-cyan-400/30 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-cyan-300">Recherche Quantum</h2>
            <button (click)="closeModal()" class="quantum-btn rounded-full h-8 w-8 !p-0 flex items-center justify-center">&times;</button>
          </div>
          <div class="p-4 overflow-y-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            @for (tech of researchTreeArray(); track tech.id) {
              <div [class]="'p-3 rounded-lg bg-black/30 border ' + getResearchStatusColor(tech.status)">
                <h4 class="font-bold text-lg" [class.text-cyan-300]="tech.status === 'researched'" [class.text-green-400]="tech.status === 'available'">{{ tech.name }}</h4>
                <p class="text-xs text-yellow-400">{{ formatNumber(tech.cost) }} cr√©dits</p>
                <p class="text-xs mt-2">D√©bloque: {{ tech.unlocks.join(', ') }}</p>
                @if (tech.status === 'available') {
                  <button class="quantum-btn w-full mt-3 py-1 px-3 text-sm rounded-md">Rechercher</button>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- DRONE CONTROL MODAL -->
      @if (activeModal() === 'drones') {
        <div class="holo-panel rounded-lg w-full max-w-2xl" (click)="$event.stopPropagation()">
          <div class="p-4 border-b border-green-400/30 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-green-300">Contr√¥le des Drones</h2>
            <button (click)="closeModal()" class="quantum-btn rounded-full h-8 w-8 !p-0 flex items-center justify-center">&times;</button>
          </div>
          <div class="p-4 text-center">
            <p>Interface de contr√¥le des drones en d√©veloppement.</p>
            <p class="text-6xl mt-4">üõ∞Ô∏è</p>
          </div>
        </div>
      }

      <!-- TIME WARP MODAL -->
      @if (activeModal() === 'time') {
        <div class="holo-panel rounded-lg w-full max-w-2xl" (click)="$event.stopPropagation()">
          <div class="p-4 border-b border-purple-400/30 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-purple-300">Contr√¥le Temporel</h2>
            <button (click)="closeModal()" class="quantum-btn rounded-full h-8 w-8 !p-0 flex items-center justify-center">&times;</button>
          </div>
          <div class="p-4 text-center">
            <p>Interface de manipulation temporelle en d√©veloppement.</p>
            <p class="text-6xl mt-4">‚è≥</p>
          </div>
        </div>
      }
    </div>
  }
</div>
